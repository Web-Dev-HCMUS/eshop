<link rel="stylesheet" href="/assets/css/checkout.css">
<link rel="stylesheet" href="/assets/css/cart.css">
<div class="cart_section">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-10 offset-lg-1">
                <div class="cart_container">
                    <div class="cart_title">Shopping Cart</div>
                    <div id="cartId" style="display:none">{{userCart.cartId}}</div>
                    <div class="cart_items">
                        <ul class="cart_list">
                            {{#each cart}}
                            <li class="cart_item clearfix" id="{{this._id}}">
                                <div class="cart_item_image"><img src="{{this.image}}" alt=""></div>
                                <div class="cart_item_info d-flex flex-md-row flex-column justify-content-between">
                                    
                                    <div class="cart_item_name cart_info_col">
                                        <div class="cart_item_title">Name</div>
                                        <div class="cart_item_text">{{this.name}}</div>
                                    </div>

                                    <div class="cart_item_quantity cart_info_col">
                                        <div class="cart_item_title ">Quantity</div>
                                        {{!-- <div class="cart_item_text">{{this.quantity}}</div> --}}
                                        <input class="form-control cart_item_text quantity" 
                                        type="number" value="{{this.quantity}}" min="1"
                                               onchange='updateQuantity(this.value,"{{this._id}}")'>
                                    </div>

                                    <div class="cart_item_price cart_info_col">
                                        <div class="cart_item_title">Price</div>
                                        <div class="cart_item_text" id="price{{this._id}}">
                                            {{numberWithCommas this.price}} VND
                                        </div>
                                    </div>

                                    <div class="cart_item_total cart_info_col">
                                        <div class="cart_item_title">Total</div>
                                        <div class="cart_item_text" id="totalPrice{{this._id}}">
                                            {{numberWithCommas this.totalPrice}} VND
                                        </div>
                                    </div>

                                    <div class="cart_remove_item cart_info_col">
                                        <div class="cart_item_title"></div>
                                        <button type='button' onclick='remove("{{this._id}}")'
                                                class='cart_item_text btn btn-light'>Remove</button>
                                    </div>
                                   
                                </div>
                                 
                            </li>
                            {{/each}}
                        </ul>
                    </div>
                    <div class="order_total">
                        <div class="order_total_content text-md-right">
                            <div class="order_total_title">Order Total:</div>
                            <div class="order_total_amount" id="orderTotal">
                                {{#if totalOrderPrice}}{{numberWithCommas totalOrderPrice}}{{else}}0{{/if}} VNƒê
                            </div>
                        </div>
                    </div>
                    <div class="cart_buttons">
                        <button type="submit" id="continue-btn" class="button cart_button_clear">Continue Shopping</button>
                        {{#if cart}}
                            <button type="button" id="checkout-btn" class="button cart_button_checkout">Check out</button>
                        {{/if}}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    const updateQuantity=(value,id)=>{
        $.get(`/cart/update/${id}?action=quantity&quantity=${value}`,{},(data) => {
            document.getElementById('orderTotal').innerHTML = `${data.totalOrderPrice} VND`;
            for(let i=0; i<data.cart.length; i++) {
                if(data.cart[i]._id === id){
                    document.getElementById(`totalPrice${id}`).innerHTML = `${data.cart[i].totalPrice} VND`;
                }
            }
        })
    }
   
    const remove=(id)=>{
        document.getElementById(`${id}`).remove();
        $.get(`/cart/update/${id}?action=remove`,{},(data)=>{
            document.getElementById('orderTotal').innerHTML = `${data.totalOrderPrice} VND`;
            document.getElementById('cartQuantity').innerHTML = data.cart.length;

            if(data.cart.length === 0){
                document.getElementById('checkout-btn').remove();
            }
        })
    }
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        $('#checkout-btn').on('click', function (event) {
            window.location.href = "/cart/checkout";
        })

        $('#continue-btn').on('click', function (event) {
            window.location.href = "/products";
        })
    })
</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>